<!DOCTYPE html>
<html lang="en-US"><head><div class="fit-vids-style">­<style> .fluid-width-video-wrapper { width: 100%; position: relative; padding: 0; } .fluid-width-video-wrapper iframe, .fluid-width-video-wrapper object, .fluid-width-video-wrapper embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; } </style></div><script src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/analytics.js" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app56.us.archive.org';v.server_ms=327;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/playback.js" charset="utf-8"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/wombat.js" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("http://www.sec-down.com:80/wordpress/?p=809","20200216223316","https://web.archive.org/","web","/_static/",
	      "1581892396");
</script>
<link rel="stylesheet" type="text/css" href="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/banner-styles.css">
<link rel="stylesheet" type="text/css" href="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/iconochive.css">
<!-- End Wayback Rewrite JS Include -->


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<!-- Responsive CSS
================================================== -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!--[if lt IE 9]>
	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
<![endif]-->


<!-- Custom Favicon
================================================== -->
<link rel="icon" type="image/png" href="https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2014/01/trojan.jpg">


<!-- Title
================================================== -->
<title>  An interesting Google vulnerability that got me 3133.7 reward. | Security Down!</title>


<!-- IE Fixes
================================================== -->
<!--[if IE]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<!--[if lte IE 7]>
	<script src="js/IE8.js" type="text/javascript"></script><![endif]-->
<!--[if lt IE 7]>
	<link rel="stylesheet" type="text/css" media="all" href="css/ie6.css"/>
<![endif]-->
<!--[if IE 7]>
	<link rel="stylesheet" type="text/css" href="http://www.sec-down.com/wordpress/wp-content/themes/supportpress/css/ie7.css" media="screen" />
<![endif]-->
<!--[if IE 8]>
	<link rel="stylesheet" type="text/css" href="http://www.sec-down.com/wordpress/wp-content/themes/supportpress/css/ie8.css" media="screen" />
<![endif]-->



<!-- WP Head
================================================== -->
<link rel="dns-prefetch" href="https://web.archive.org/web/20200216223316/http://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="Security Down! » Feed" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?feed=rss2">
<link rel="alternate" type="application/rss+xml" title="Security Down! » Comments Feed" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?feed=comments-rss2">
<link rel="alternate" type="application/rss+xml" title="Security Down! » An interesting Google vulnerability that got me 3133.7 reward. Comments Feed" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?feed=rss2&amp;p=809">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/web.archive.org\/web\/20200216223316\/https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/web.archive.org\/web\/20200216223316\/https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/web.archive.org\/web\/20200216223316\/http:\/\/www.sec-down.com\/wordpress\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.1"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b===c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/wp-emoji-release.js" type="text/javascript" defer="defer"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="framework-css" href="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/framework.css" type="text/css" media="all">
<link rel="stylesheet" id="framework-responsive-css" href="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/framework_responsive.css" type="text/css" media="all">
<link rel="stylesheet" id="style-css" href="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="responsive-css" href="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/responsive.css" type="text/css" media="all">
<link rel="stylesheet" id="prth-color-skin-css" href="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/dark-blue.css" type="text/css" media="all">
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/jquery.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/jquery-migrate.js"></script>
<link rel="https://api.w.org/" href="http://www.sec-down.com/wordpress/index.php?rest_route=/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.sec-down.com/wordpress/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.sec-down.com/wordpress/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Hacking First.org private keys for fun and profit, or maybe not!" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=772">
<meta name="generator" content="WordPress 4.8.1">
<link rel="canonical" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809">
<link rel="shortlink" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809">
<link rel="alternate" type="application/json+oembed" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=http%3A%2F%2Fwww.sec-down.com%2Fwordpress%2F%3Fp%3D809">
<link rel="alternate" type="text/xml+oembed" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=http%3A%2F%2Fwww.sec-down.com%2Fwordpress%2F%3Fp%3D809&amp;format=xml">
<!-- Custom CSS -->
<style type="text/css">
body{background-image: url(https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/themes/supportpress/images/backgrounds/bg13.png); background-repeat: repeat; -webkit-background-size: auto;-moz-background-size: auto;-o-background-size: auto;background-size: auto;}
</style><style type="text/css" media="screen"> 
      html { margin-top: 0px !important; } 
      * html body { margin-top: 0px !important; } 
      </style>
</head><!-- /end head -->

<!-- Begin Body
================================================== -->
<body class="post-template-default single single-post postid-809 single-format-standard body dark-blue"><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" style="display: block; direction: ltr;" lang="en">
</div><div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/donate.html" scrolling="no" style="width:100%; height:100%" frameborder="0">
    </iframe>
  </div>
</div><script type="text/javascript">
__wm.bt(650,27,25,2,"web","http://www.sec-down.com/wordpress/?p=809","20200216223316",1996,"/_static/",["/_static/css/banner-styles.css?v=bsmaklHF","/_static/css/iconochive.css?v=qtvMKcIJ"]);
  __wm.rw(1);
</script>
<!-- END WAYBACK TOOLBAR INSERT -->


    <div id="topbar" class="topbar-fixed">
        <div id="topbar-inner" class="outer-container clearfix">
                <nav id="top-navigation">
                    <div class="menu-home-container"><ul id="menu-home" class="top-menu-nav sf-menu sf-js-enabled sf-shadow">
<li id="menu-item-57" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home"><a href="index.html"><span class="menu-title-top">Home</span></a></li>
<li id="menu-item-261" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="404.html"><span class="menu-title-top">News</span></a></li>
<li id="menu-item-223" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="404.html"><span class="menu-title-top">Services</span></a></li>
<li id="menu-item-23" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="about.html"><span class="menu-title-top">About Me</span></a></li>
<li id="menu-item-219" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="contact.html"><span class="menu-title-top">Contact</span></a></li>
</ul></div>                <div class="selector" id="uniform-undefined"><span style="user-select: none;">
Go to...</span><select style="opacity: 0;"><option selected="selected" value="">Go to...</option><option value="http://www.sec-down.com/wordpress/">
Home</option><option value="http://www.sec-down.com/wordpress/?page_id=259">News
</option><option value="http://www.sec-down.com/wordpress/?page_id=25">Services
</option><option value="http://www.sec-down.com/wordpress/?page_id=8">About Me</option><option value="http://www.sec-down.com/wordpress/?page_id=97">Contact</option></select></div></nav><!-- /topbar-nav -->



                            <div id="header-right">
                                                                        <div id="search-box">
                                    <form method="get" id="searchbar" action="https://web.archive.org/web/20200214045447/http://www.sec-down.com/wordpress/">
<input type="search" name="s" placeholder="Search...">
</form>                         </div><!-- /search-box -->

                                                            </div><!-- /header-right -->






            <div id="responsive-login">


                                <!-- INSERT LOGGED IN INFO HERE - RESPONSIVE, PHONE -->
				<span>
					<img alt="" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/a.jpeg" srcset="https://web.archive.org/web/20200216223316im_/http://0.gravatar.com/avatar/?s=100&amp;r=g 2x" class="avatar avatar-50 photo avatar-default">					<a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/wp-login.php?action=logout&amp;redirect_to=http%3A%2F%2Fwww.sec-down.com%2Fwordpress&amp;_wpnonce=a8365ef62a">Log Out</a>
				</span>
       
       
            </div><!-- /res[onsivelogin -->


        </div><!-- /topbar-inner -->
    </div><!-- /topbar -->


<header id="header" class="outer-container clearfix">

    <div id="logo">
                    <a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/" title="" rel="home"><img src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/logoz.png" alt=""></a>
            </div><!-- /logo -->
    
    
    
    
    <div id="right-header">
    
	   <!-- INSERT LOGIN HERE -->
    	<div id="sub-header-user" style="">

			<div id="sub-header-pic" style="">
					<img alt="" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/a.jpeg" srcset="https://web.archive.org/web/20200216223316im_/http://0.gravatar.com/avatar/?s=100&amp;r=g 2x" class="avatar avatar-50 photo avatar-default">		   	</div>
	   		
			
							      
				    <div id="sub-header-info" style="margin-top:5px;font-style:italic;">
				      <span>You are not logged in<br>
					      <a href="">Log In</a>
				      </span>
				      
				      
					
				</div>
			
			</div>

    </div><!-- /right-header -->
    
</header><!-- /header -->

<div id="wrap" class="outer-container clearfix">

    <nav id="navigation" class="clearfix">
                
    <div class="selector" id="uniform-undefined"><span style="user-select: none;">Go to...</span><select style="opacity: 0;"><option selected="selected" value="">Go to...</option></select></div></nav><!-- /navigation -->  
    
	<div id="content-main" class="clearfix fitvids-container">

   
	 
<header id="page-heading">
	<h1>An interesting Google vulnerability that got me 3133.7 reward.</h1>
	<nav id="post-navigation" class="clearfix"> 
                <div id="post-navigation-right"><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=772" rel="prev"><span class="inner"><i class="icon-chevron-right"></i></span></a></div>    </nav><!-- /post-navigation --> 
</header><!-- /post-meta -->

<div id="post" class="clearfix">
      
                    <section class="meta clearfix" id="single-meta">
                <ul>
                    <li>Posted: October 4, 2018</li>    
                    <li>In: <a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?cat=6" rel="category">Vulnerabilities</a></li>
                    <li class="comment-scroll"><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809#comments">3 Comments</a></li>
                    <li>By: <a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?author=1" title="Posts by zigoo" rel="author">zigoo</a></li>
               </ul>
            </section><!--/meta -->
                
        		<div id="post-thumbnail">
			<a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/ban.png" title="An interesting Google vulnerability that got me 3133.7 reward." class="prettyphoto-link">
            	<img src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/ban.png" alt="An interesting Google vulnerability that got me 3133.7 reward.">
            </a>
		</div><!-- /post-thumbnail -->
                
       
		<article id="single-post" class="entry clearfix">
			<p><em>Note: This blog post doesn’t represent my employer by any meaning and was performed during my free time.</em></p>
<p>Hi All 🙂</p>
<p>Before we start, 3133.7 stands for Elite. It is a leet/1337 way of Google to reward researchers 😀</p>
<p>While doing security researching on Google. Decided to focus on 
“Cloud.google.com” as it sounds interesting with lots of features.</p>
<p>During my testing, saw the following very interesting request in the Burp Proxy going to:</p>
<p><a href="https://web.archive.org/web/20200216223316/https://cloudusersettings-pa.clients6.google.com/batch?%24ct=multipart%2Fmixed%3B%20boundary%3Dbatch392541909285510985">https://cloudusersettings-pa.clients6.google.com/batch?%24ct=multipart%2Fmixed%3B%20boundary%3Dbatch392541909285510985</a></p>
<p><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/request1.png"><img class="alignnone size-full wp-image-814" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/request1.png" alt="" srcset="https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/request1.png 740w, https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/request1-300x225.png 300w" sizes="(max-width: 740px) 100vw, 740px"></a></p>
<p><em>Note: Page original response is “Not found” within a JSON format. Not that important to include here.</em></p>
<p>Immediately 2 things got my attention. First, the GET request within 
the POST request body along with the request headers as well. Second is 
being able to control the content-type via the value in the URL of the 
main request. Later on, noticed that there is a KEY being sent within 
the POST request body.</p>
<p><span style="color: #0000ff;"><strong>My expectation:&nbsp;</strong> </span></p>
<p>The server of “cloudusersettings-pa.clients6.google.com” is relaying 
the GET request via the POST request body to an intermediary server 
(reverse proxy / load balancer) that would parse it somehow and process 
it or pass it over to a third-server. The intermediary server doesn’t 
care about the headers of the original POST request, but only parses the
 GET request headers that are being sent within the POST request body.</p>
<p><span style="color: #0000ff;">Well, few things to conclude this is:</span></p>
<p>1) I’m able to control the headers that the intermediary server will process;</p>
<p>2) It is possible to control the response type via the value below marked in red:</p>
<p>https://cloudusersettings-pa.clients6.google.com/batch?%24ct=<span style="color: #ff0000;">multipart%2Fmixed%3B%20boundary%3Dbatch392541909285510985</span></p>
<p>3) There is a key and authorization header values in the request.</p>
<p>To get directly to the point, number 2 and 3 led to nothing. But the good point is,<span style="color: #0000ff;"> it was not being validated.</span> lets keep a note of that.</p>
<p>Now to the interesting part, which is manipulating the HTTP request 
headers itself. My approach was to perform the following test cases 
against the GET request in the POST body:</p>
<p>1) Play around the HOST header “Virtual Hostname Enumeration”. Like 
setting the host header to dev, localhost, portal, and so on. So that 
the webserver is tricked into disclosing locally configured virtual 
hostnames. Thus, allowing access to internal environments. (<span style="color: #ff0000;">Didn’t work</span>)</p>
<p>2) Spoofing my IP address by the following headers. Trying to induce 
the backend server that receives the request to treat it in a different 
way. (<span style="color: #ff0000;">Didn’t work</span>)</p>
<ul>
<li>X-Forwarded-For: 127.0.0.1</li>
<li>X-Client-IP: 127.0.0.1</li>
<li>Client-IP: 127.0.0.1</li>
</ul>
<p>3) Forcing the backend server to through some errors. Have tried this
 by sending large input of AAAAA’s, changing the HTTP protocol version 
instead of 1.1 to something else, adding some random headers or 
manipulate the existing once, manipulating the content-type and so on (<span style="color: #ff0000;">Didn’t work</span>)</p>
<p>4) Blind XSS/SQLI in the userAgent value, it might get processed at some point! (<span style="color: #ff0000;">Didn’t work</span>)</p>
<p>5) Have also tried to manipulate the origin header to hopefully find a
 misconfigured CORS implementation, but the origin was well validated.</p>
<p>Was out of options, till I thought of why don’t I directly “talk” to 
the backend server the way it understands?! A web server spoken language
 is basically headers! It sees header, it parse it, then process it, 
Simple!</p>
<p><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/clVPw1538666378.png"><img class="size-full wp-image-821 aligncenter" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/clVPw1538666378.png" alt="" srcset="https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/clVPw1538666378.png 430w, https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/clVPw1538666378-274x300.png 274w" sizes="(max-width: 430px) 100vw, 430px"></a></p>
<p>One of the interesting headers that allows you to “talk” to the web server is “<span style="color: #ff0000;">X-HTTP-Method-Override</span>“.
 This header basically allows some magic stuff. For example, you can 
send GET request to the server, but the server would treat it as PUT, 
POST, DELETE or whatever the method you declared! yes, although it is 
originaly a GET request 😀</p>
<p>An example is:</p>
<p><span style="color: #0000ff;">GET</span> /test.php HTTP/1.1<br>
Host: google.com<br>
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Firefox/45.0<br>
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br>
Accept-Language: en-US,en;q=0.5<br>
<span style="color: #0000ff;">X-HTTP-Method-Override</span>: <span style="color: #ff6600;">PUT</span><br>
Accept-Encoding: gzip, deflate<br>
Connection: close</p>
<p>When the web server receives the above <span style="color: #0000ff;">GET</span> request and parse it, it will find the XHMO header in there and would say</p>
<p>“Oh! this is a GET request but the user wants me to treat it as PUT, consider it done, Sir!” and treat it as PUT instead 😀</p>
<p>The reason of why this behavior is needed, some intermediary servers 
(reverse proxy/load balancers, WAF’s) are limited in the HTTP methods it
 supports (i.e. Only GET and POST is supported). However, the developers
 might still want to send a “PATCH, DELETE, PUT” methods. Here is where 
the XHMO comes to play.</p>
<p>Oh, and did i mention that I have once triggered RCE via the HTTP PUT
 method and webdav was enabled, while there was F5 WAF watching all the 
traffic?</p>
<p><span style="color: #0000ff;">My burp repeater <strong>—-&gt;</strong></span> Hey Web server, I want you to create a file via PUT method <strong><span style="color: #0000ff;">—-&gt;</span></strong> F5 says: You have to pass through me first, and I only support GET/POST! <strong><span style="color: #0000ff;">—-&gt;</span></strong><span style="color: #ff0000;"> FAIL!</span></p>
<p><span style="color: #0000ff;">My burp repeater <strong>—-&gt; </strong></span>Hey
 F5, I know that the backend server supports PUT, so here is your GET 
request with XHMO set to PUT. Please pass it to the backend server <strong><span style="color: #0000ff;">—-&gt;</span></strong> F5 says: sure, seems legit! <span style="color: #0000ff;"><strong>—-&gt;</strong></span>
 Backend webserver: yea, another PUT request to handle. HYG, your file 
is created because I do support PUT and I understood your call. <strong><span style="color: #0000ff;">—-&gt;</span></strong> <span style="color: #00ff00;"><span style="color: #008000;">Bingo!</span></span></p>
<p>With all details being said, have added the XHMO header to the 
request with HTTP method PUT hoping that webdav is enabled on the 
backend webserver so that I could somehow get RCE. And no, it didn’t 
work, Buuuuut!</p>
<p>The middle webserver couldn’t understand what to do with that header!
 so it decided to through a very much detailed error message that 
discloses:</p>
<ul>
<li>HTTPOnly and Secure cookies!</li>
<li>All communication details of the connection between the intermediary
 server and the backend server. Including SSL hello message, IP’s, ports
 and so on;</li>
<li>Also the authorization headers and few more interesting messages too.</li>
</ul>
<p><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/response.png"><img class="alignnone size-large wp-image-825" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/response-1024x464.png" alt="" srcset="https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/response-1024x464.png 1024w, https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/response-300x136.png 300w, https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/response-768x348.png 768w, https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/response.png 1256w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p>
<p>Note: the screenshot is being in bad quality on purpose.</p>
<p>Remember when I said that nothing in the request was being validated?
 based on that, have created a CSRF POC that would trigger the same 
exact response for other Google users. And it is possible to steal these
 information using a reflected XSS!</p>
<p>In theory, HTTPOnly cookies are well secure against XSS attacks. But 
using this vulnerability, it is possible to steal the HTTPOnly cookies 
from Google users who are tricked into clicking the malicious link.</p>
<p>And that only happened when adding the XHMO header. The page originally returns a ‘not found’ response.</p>
<p>Have reported the vulnerability to Google, the team have set the 
priority to P1. They were fast in responses and handled the 
vulnerability professionally. Later on, received below Email from 
Google:</p>
<p><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/bounty.png"><img class="alignnone size-full wp-image-841" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/bounty.png" alt="" srcset="https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/bounty.png 727w, https://web.archive.org/web/20200216223316im_/http://www.sec-down.com/wordpress/wp-content/uploads/2018/10/bounty-300x292.png 300w" sizes="(max-width: 727px) 100vw, 727px"></a></p>
<p>Hope you enjoyed reading &nbsp;🙂</p>
<p>Cheers,</p>
<p>Ebrahem Hegazy – @Zigoo0</p>
<p>&nbsp;</p>
        </article><!-- /entry -->
        
        
                
		        
        
				<div id="single-portfolio-related" class="clearfix">
                <h3 class="heading"><span>Related Articles</span></h3>
			<div class="grid-container">
                                <div class="portfolio-post grid-3">
                                             <a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=494" title="Yahoo SQL Injection to Remote Code Exection to Root Privilege." class="portfolio-post-img-link">
                         	<img class="portfolio-post-img" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/0day_design-Y.png" alt="Yahoo SQL Injection to Remote Code Exection to Root Privilege.">
                         </a>
                                        <div class="portfolio-post-description">
                      <h2><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=494">Yahoo SQL Injection to Remote Code Exection to Root Privilege.</a></h2>
                      <div class="portfolio-post-excerpt">
                        Hello from Egypt :D Today I will blog about a 
SQL Injection vulnerability that were escalated to Remote Code 
Execution, Escalated to Root Privilege on...<a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=494" class="read-more">read more →</a>
                      </div><!-- /related-entry-excerpt -->
                    </div>
                    <!-- /related-entry-content -->
                </div>
                <!-- /related-entry -->
                                <div class="portfolio-post grid-3">
                                             <a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=581" title="Telekom.de Remote Command Execution!" class="portfolio-post-img-link">
                         	<img class="portfolio-post-img" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/telekom-flucht-usa-450x300.jpg" alt="Telekom.de Remote Command Execution!">
                         </a>
                                        <div class="portfolio-post-description">
                      <h2><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=581">Telekom.de Remote Command Execution!</a></h2>
                      <div class="portfolio-post-excerpt">
                        Salam from Egypt :D Welcome to this blog post 
about a Remote Command Execution Vulnerability that affected Telekom.de!
 It all started when i found below...<a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=581" class="read-more">read more →</a>
                      </div><!-- /related-entry-excerpt -->
                    </div>
                    <!-- /related-entry-content -->
                </div>
                <!-- /related-entry -->
                                <div class="portfolio-post grid-3">
                                             <a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=180" title="Kaspersky.com Unvalidated Redirection Vulnerability." class="portfolio-post-img-link">
                         	<img class="portfolio-post-img" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/10105.jpeg" alt="Kaspersky.com Unvalidated Redirection Vulnerability.">
                         </a>
                                        <div class="portfolio-post-description">
                      <h2><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=180">Kaspersky.com Unvalidated Redirection Vulnerability.</a></h2>
                      <div class="portfolio-post-excerpt">
                        Would you trust a link from your security 
vendor? Absolutely Yes! But imagine your security vendor is asking you 
to download a malware! During my...<a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=180" class="read-more">read more →</a>
                      </div><!-- /related-entry-excerpt -->
                    </div>
                    <!-- /related-entry-content -->
                </div>
                <!-- /related-entry -->
                			</div>
            </div> 
            <!-- /end related-posts --> 
                        
        
        <div id="commentsbox">
	<div id="comments" class="comments-area clearfix">
    
            
            
                    <h3 class="heading-border heading"><span><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809#comments">3 Comments</a></span></h3>
    
                
            <ol class="commentlist">
                	<li class="comment even thread-even depth-1" id="li-comment-47674">
		<div id="comment-47674" class="comment-body  clearfix">
                <div class="comment-details">
                    <div class="comment-avatar">
                        <img alt="" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/6ba2d57e859e27705753aba9f5f770bf.jpeg" srcset="https://web.archive.org/web/20200216223316im_/http://0.gravatar.com/avatar/6ba2d57e859e27705753aba9f5f770bf?s=90&amp;r=g 2x" class="avatar avatar-45 photo">                    </div><!-- /comment-avatar -->
                    <section class="comment-author vcard">
						<cite class="author">xss</cite>						<span class="comment-date"><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809#comment-47674">- October 5, 2018</a></span>
                    </section><!-- /comment-meta -->
                    <section class="comment-content">
    	                <div class="comment-text">
    	                    <p>Nice.. Have a query though..</p>
<p>How did you inject XHMO header via a CSRF POC? I not sure on how it 
can be exploited against other users in real world. Can you please 
explain more on that. Thanks.</p>
    	                </div><!-- /comment-text -->
    	                <div class="reply">
    	                    <a rel="nofollow" class="comment-reply-link" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809&amp;replytocom=47674#respond" onclick='return addComment.moveForm( "comment-47674", "47674", "respond", "809" )' aria-label="Reply to xss">Reply to comment→</a>    	                </div><!-- /reply -->
                    </section><!-- /comment-content -->
				</div><!-- /comment-details -->
		</div><!-- /comment -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-48658">
		<div id="comment-48658" class="comment-body  clearfix">
                <div class="comment-details">
                    <div class="comment-avatar">
                        <img alt="" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/f57894f3952aef72f55cb7f1819c5ce8.jpeg" srcset="https://web.archive.org/web/20200216223316im_/http://0.gravatar.com/avatar/f57894f3952aef72f55cb7f1819c5ce8?s=90&amp;r=g 2x" class="avatar avatar-45 photo">                    </div><!-- /comment-avatar -->
                    <section class="comment-author vcard">
						<cite class="author">Ebrahim</cite>						<span class="comment-date"><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809#comment-48658">- February 5, 2019</a></span>
                    </section><!-- /comment-meta -->
                    <section class="comment-content">
    	                <div class="comment-text">
    	                    <p>Hi XSS,<br>
I did not add it as a header to the original request, but as a normal 
POST parameter&amp;value. The reason is as you see in the first 
screenshot, there are 2 different requests within the same request, the 
preferred one is sent as a POST data within the original request.</p>
    	                </div><!-- /comment-text -->
    	                <div class="reply">
    	                    <a rel="nofollow" class="comment-reply-link" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809&amp;replytocom=48658#respond" onclick='return addComment.moveForm( "comment-48658", "48658", "respond", "809" )' aria-label="Reply to Ebrahim">Reply to comment→</a>    	                </div><!-- /reply -->
                    </section><!-- /comment-content -->
				</div><!-- /comment-details -->
		</div><!-- /comment -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-49766">
		<div id="comment-49766" class="comment-body  clearfix">
                <div class="comment-details">
                    <div class="comment-avatar">
                        <img alt="" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/94a14ff38bc894f881ea240418708a3b.jpeg" srcset="https://web.archive.org/web/20200216223316im_/http://0.gravatar.com/avatar/94a14ff38bc894f881ea240418708a3b?s=90&amp;r=g 2x" class="avatar avatar-45 photo">                    </div><!-- /comment-avatar -->
                    <section class="comment-author vcard">
						<cite class="author"><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/" rel="external nofollow" class="url">Ebrahim Hegazy</a></cite>						<span class="comment-date"><a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809#comment-49766">- June 11, 2019</a></span>
                    </section><!-- /comment-meta -->
                    <section class="comment-content">
    	                <div class="comment-text">
    	                    <p>Hi “XSS”,<br>
That was easy indeed, because it was treated as a POST body, and not a new Request Header.</p>
    	                </div><!-- /comment-text -->
    	                <div class="reply">
    	                    <a rel="nofollow" class="comment-reply-link" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809&amp;replytocom=49766#respond" onclick='return addComment.moveForm( "comment-49766", "49766", "respond", "809" )' aria-label="Reply to Ebrahim Hegazy">Reply to comment→</a>    	                </div><!-- /reply -->
                    </section><!-- /comment-content -->
				</div><!-- /comment-details -->
		</div><!-- /comment -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
            </ol><!-- /commentlist -->
    
                
            
            
    		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"></h3><h4 class="heading"><span>Leave a reply</span></h4> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/?p=809#respond" style="display:none;">Cancel reply</a></small>			<form action="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/wp-comments-post.php" method="post" id="commentform" class="comment-form">
				<p class="comment-form-comment"><textarea id="comment" name="comment" aria-required="true" rows="10" placeholder="You can leave a reply here."></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label><input id="author" name="author" type="text" size="30" aria-required="true"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label><input id="email" name="email" type="text" size="30" aria-required="true"></p>
<p class="comment-form-url"><label for="url">Website</label><input id="url" name="url" type="text" size="30"></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit Comment"> <input type="hidden" name="comment_post_ID" value="809" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="2d638e2b9a"></p><p style="display: none;"></p>			<input type="hidden" id="ak_js" name="ak_js" value="1581892406655"></form>
			</div><!-- #respond -->
	    
    </div><!-- /comments -->
</div><!-- /commentsbox -->        
</div><!-- /post -->

<div id="sidebar">


	

</div>
<!-- /sidebar --><div class="clear"></div>

		<div id="footer-header" class="clearfix">
			<div id="footer-header-text"></div><!-- /footer-header-text -->
		</div><!-- /footer-footer-header -->

</div><!-- /content-main -->
    <footer id="footer">
    	    </footer>
    <!-- /footer -->
    <div id="footer-bottom">
    	<div class="grid-container clearfix">
            <div id="footer-menu" class="grid-2 no-btm-margin">
                                            </div><!-- /footer-menu -->
            <div id="copyright" class="grid-2 no-btm-margin">
                                © Copyright 2020 <a href="https://web.archive.org/web/20200216223316/http://www.sec-down.com/wordpress/" title="Security Down!" rel="home">Security Down!</a>
                            </div><!-- /copyright notice -->
    	</div><!-- /grid-container -->
    </div><!-- /footer-bottom --> 
</div><!-- /wrap -->
    
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/core.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/widget.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/accordion.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/tabs.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/easing.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/hoverIntent.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/superfish.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/flexslider-min.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/comment-reply.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/fitvids.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/uniform.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var responsiveLocalize = {"text":"Go to..."};
/* ]]> */
</script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/responsive.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/initialize.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/wp-embed.js"></script>
<script type="text/javascript" src="An%20interesting%20Google%20vulnerability%20that%20got%20me%203133.7%20reward.%20|%20Security%20Down!_files/form.js"></script>


</body></html>
<!--
     FILE ARCHIVED ON 22:33:16 Feb 16, 2020 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 23:38:31 Jan 20, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  PetaboxLoader3.datanode: 246.973 (4)
  LoadShardBlock: 232.368 (3)
  RedisCDXSource: 0.813
  captures_list: 258.797
  exclusion.robots: 0.289
  esindex: 0.016
  load_resource: 43.012
  PetaboxLoader3.resolve: 23.059
  exclusion.robots.policy: 0.275
  CDXLines.iter: 21.939 (3)
-->
